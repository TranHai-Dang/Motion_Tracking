<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Posture Monitor</title>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; }
        .grid-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; height: 70vh;
        }
        .cam-box {
            background: #000; border: 3px solid #333; position: relative;
            display: flex; justify-content: center; align-items: center; 
            border-radius: 10px; overflow: hidden;
        }
        img { width: 100%; height: 100%; object-fit: contain; }
        .label {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.8); color: white; padding: 5px 12px; 
            border-radius: 4px; font-weight: bold; font-size: 14px;
        }
        .status-panel { 
            margin: 20px; padding: 20px; border-radius: 8px;
            font-size: 24px; font-weight: bold; background: #333; 
            transition: background-color 0.5s;
        }
        button {
            padding: 12px 30px; font-size: 16px; margin-top: 15px;
            background: #0984e3; color: white; border: none; 
            cursor: pointer; border-radius: 6px; font-weight: bold;
        }
        button:hover { background: #74b9ff; transform: scale(1.05); transition: 0.2s; }
        .tip { font-size: 14px; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

<div style="padding:15px; background:#1f1f1f; border-bottom: 1px solid #333;">
    <h1 style="margin:0">üõ°Ô∏è H·ªÜ TH·ªêNG GI√ÅM S√ÅT T∆Ø TH·∫æ</h1>
</div>

<div class="grid-container">
    <div class="cam-box" id="box-front">
        <div class="label">CAM 1: CH√çNH DI·ªÜN (Front)</div>
        <img src="{{ url_for('video_front') }}" alt="ƒêang t·∫£i Cam 1...">
    </div>
    <div class="cam-box" id="box-side">
        <div class="label">CAM 2: B√äN C·∫†NH (Side)</div>
        <img src="{{ url_for('video_side') }}" alt="ƒêang t·∫£i Cam 2...">
    </div>
</div>

<div class="status-panel" id="main-status">
    ƒêANG KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG...
    <br>
    <button onclick="calibrate()">üéØ THI·∫æT L·∫¨P T∆Ø TH·∫æ CHU·∫®N (CAM TR∆Ø·ªöC)</button>
    <div class="tip">H∆∞·ªõng d·∫´n: Ng·ªìi th·∫≥ng, nh√¨n v√†o Cam Tr∆∞·ªõc v√† b·∫•m n√∫t tr√™n. Cam b√™n c·∫°nh kh√¥ng c·∫ßn thi·∫øt l·∫≠p.</div>
</div>

<audio id="alarmSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>

<script>
    function calibrate() {
        fetch('/calibrate_front').then(res => res.json()).then(data => {
            alert(data.status === 'success' ? "‚úÖ ƒê√£ l∆∞u t∆∞ th·∫ø chu·∫©n!" : "‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y camera!");
        });
    }

    function updateBorder(element, status) {
        if (status === true) {
            element.style.borderColor = "#00b894"; // Xanh ng·ªçc (T·ªët)
            element.style.boxShadow = "0 0 15px #00b894";
        } else if (status === false) {
            element.style.borderColor = "#d63031"; // ƒê·ªè (X·∫•u)
            element.style.boxShadow = "0 0 15px #d63031";
        } else {
            element.style.borderColor = "#636e72"; // X√°m (Null)
            element.style.boxShadow = "none";
        }
    }

    setInterval(() => {
        fetch('/check_status').then(res => res.json()).then(data => {
            const boxFront = document.getElementById('box-front');
            const boxSide = document.getElementById('box-side');
            const mainStatus = document.getElementById('main-status');
            const audio = document.getElementById('alarmSound');

            updateBorder(boxFront, data.front);
            updateBorder(boxSide, data.side);

            if (data.alarm) {
                mainStatus.style.backgroundColor = '#d63031';
                mainStatus.innerHTML = "‚ö†Ô∏è C·∫¢NH B√ÅO: SAI T∆Ø TH·∫æ QU√Å L√ÇU! H√ÉY CH·ªàNH L·∫†I!";
                audio.play().catch(() => {});
            } else {
                audio.pause();
                audio.currentTime = 0;
                
                if (data.front === false || data.side === false) {
                    mainStatus.style.backgroundColor = '#e17055';
                    mainStatus.innerText = "‚ö†Ô∏è Ph√°t hi·ªán t∆∞ th·∫ø x·∫•u...";
                } else if (data.front === true && data.side === true) {
                    mainStatus.style.backgroundColor = '#00b894';
                    mainStatus.innerText = "‚úÖ T∆∞ th·∫ø chu·∫©n. Ti·∫øp t·ª•c gi·ªØ v·ªØng!";
                } else {
                    mainStatus.style.backgroundColor = '#2d3436';
                    mainStatus.innerText = "üîç ƒêang t√¨m ng∆∞·ªùi / H√£y Set Chu·∫©n...";
                }
            }
        });
    }, 500);
</script>

</body>
</html>