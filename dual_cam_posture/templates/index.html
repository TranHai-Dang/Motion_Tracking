<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dual-Cam Posture AI</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; }
        .grid-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; height: 75vh;
        }
        .cam-box {
            background: #000; border: 4px solid #444; position: relative;
            display: flex; justify-content: center; align-items: center; overflow: hidden; border-radius: 8px;
        }
        img { width: 100%; height: 100%; object-fit: contain; }
        .label {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px; font-weight: bold;
        }
        .status-panel { padding: 20px; font-size: 22px; font-weight: bold; background: #333; transition: 0.3s; }
        button {
            padding: 12px 24px; font-size: 16px; margin-top: 10px;
            background: #0984e3; color: white; border: none; cursor: pointer; border-radius: 5px;
        }
        button:hover { background: #74b9ff; }
    </style>
</head>
<body>

<div style="padding:10px; background:#222"><h1>üõ°Ô∏è AI POSTURE GUARD</h1></div>

<div class="grid-container">
    <div class="cam-box" id="box-front">
        <div class="label">CAM 1: FRONT</div>
        <img src="{{ url_for('video_front') }}" alt="Loading Front Cam...">
    </div>
    <div class="cam-box" id="box-side">
        <div class="label">CAM 2: SIDE</div>
        <img src="{{ url_for('video_side') }}" alt="Loading Side Cam...">
    </div>
</div>

<div class="status-panel" id="main-status">
    H·ªÜ TH·ªêNG ƒêANG CH·ªú T√çN HI·ªÜU...
    <br>
    <button onclick="calibrate()">üéØ THI·∫æT L·∫¨P CHU·∫®N (FRONT)</button>
</div>

<audio id="alarmSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>

<script>
    function calibrate() {
        fetch('/calibrate_front').then(res => res.json()).then(data => {
            alert(data.status === 'success' ? "ƒê√£ l∆∞u t∆∞ th·∫ø chu·∫©n!" : "L·ªói ƒë·ªçc Camera!");
        });
    }

    function updateBorder(element, status) {
        if (status === true) element.style.borderColor = "#2ecc71"; // Xanh (T·ªët)
        else if (status === false) element.style.borderColor = "#e74c3c"; // ƒê·ªè (X·∫•u)
        else element.style.borderColor = "#95a5a6"; // X√°m (Kh√¥ng th·∫•y ng∆∞·ªùi)
    }

    setInterval(() => {
        fetch('/check_status').then(res => res.json()).then(data => {
            const boxFront = document.getElementById('box-front');
            const boxSide = document.getElementById('box-side');
            const mainStatus = document.getElementById('main-status');
            const audio = document.getElementById('alarmSound');

            // C·∫≠p nh·∫≠t vi·ªÅn cho t·ª´ng cam
            updateBorder(boxFront, data.front);
            updateBorder(boxSide, data.side);

            // X·ª≠ l√Ω logic t·ªïng
            if (data.alarm) {
                mainStatus.style.backgroundColor = '#c0392b';
                mainStatus.innerHTML = "‚ö†Ô∏è C·∫¢NH B√ÅO: NG·ªíI SAI T∆Ø TH·∫æ!!!";
                audio.play().catch(() => {});
            } else {
                audio.pause();
                audio.currentTime = 0;
                
                // Logic hi·ªÉn th·ªã tr·∫°ng th√°i
                if (data.front === false || data.side === false) {
                    mainStatus.style.backgroundColor = '#d35400';
                    mainStatus.innerText = "‚ö†Ô∏è ƒêang ng·ªìi sai...";
                } else if (data.front === true && data.side === true) {
                    mainStatus.style.backgroundColor = '#27ae60';
                    mainStatus.innerText = "‚úÖ T∆∞ th·∫ø chu·∫©n";
                } else {
                    mainStatus.style.backgroundColor = '#444';
                    mainStatus.innerText = "üîç ƒêang t√¨m ng∆∞·ªùi / Ch∆∞a Set Chu·∫©n...";
                }
            }
        });
    }, 500);
</script>

</body>
</html>